import type { CvssBasedAttackExploitability } from "../types/base/attack-exploitability";

export const CvssBasedAttackExploitabilityBase: CvssBasedAttackExploitability = {
    name: "CVSS-based Attack Exploitability",
    label: "基于CVSS的攻击利用性",
    description: "基于CVSS指标的攻击利用性评估",
    attackVectorMetric: {
        name: "Attack Vector",
        label: "攻击向量",
        description: "攻击向量指标",
        range: [0.2, 0.85],
    },
    attackComplexityMetric: {
        name: "Attack Complexity",
        label: "攻击复杂度",
        description: "攻击复杂度指标",
        range: [0.44, 0.77],
    },
    privilegesRequiredMetric: {
        name: "Privileges Required",
        label: "权限要求",
        description: "权限要求指标",
        range: [0.27, 0.85],
    },
    userInteractionMetric: {
        name: "User Interaction",
        label: "用户交互",
        description: "用户交互指标",
        range: [0.62, 0.85],
    },
    formula: "E = 8.22 * AV * AC * PR * UI",
    range: [0.12, 3.89],
}

/**
 * 计算攻击利用性
 * @param attackVector 攻击向量指标
 * @param attackComplexity 攻击复杂度指标
 * @param privilegesRequired 权限要求指标
 * @param userInteraction 用户交互指标
 * @returns 攻击利用性指标
 */
export const calculateAttackExploitability = (attackVector: number, attackComplexity: number, privilegesRequired: number, userInteraction: number) => {
    return 8.22 * attackVector * attackComplexity * privilegesRequired * userInteraction;
}

/**
 * 获取攻击可行性等级
 * @param attackExploitability 攻击利用性指标
 * @returns 攻击可行性等级
 */
export const getAttackFeasibilityRating = (attackExploitability: number) => {
    if (attackExploitability >= 2.96 && attackExploitability <= 3.89) {
        return "High";
    }

    if (attackExploitability >= 2.00 && attackExploitability <= 2.95) {
        return "Medium";
    }

    if (attackExploitability >= 1.06 && attackExploitability <= 1.99) {
        return "Low";
    }

    if (attackExploitability >= 0.12 && attackExploitability <= 1.05) {
        return "Very Low";
    }

    throw new Error("Invalid attack exploitability value");
}

export const checkAttackVectorRange = (attackVector: number) => {
    return attackVector >= CvssBasedAttackExploitabilityBase.attackVectorMetric.range[0] && attackVector <= CvssBasedAttackExploitabilityBase.attackVectorMetric.range[1];
}

export const checkAttackComplexityRange = (attackComplexity: number) => {
    return attackComplexity >= CvssBasedAttackExploitabilityBase.attackComplexityMetric.range[0] && attackComplexity <= CvssBasedAttackExploitabilityBase.attackComplexityMetric.range[1];
}

export const checkPrivilegesRequiredRange = (privilegesRequired: number) => {
    return privilegesRequired >= CvssBasedAttackExploitabilityBase.privilegesRequiredMetric.range[0] && privilegesRequired <= CvssBasedAttackExploitabilityBase.privilegesRequiredMetric.range[1];
}

export const checkUserInteractionRange = (userInteraction: number) => {
    return userInteraction >= CvssBasedAttackExploitabilityBase.userInteractionMetric.range[0] && userInteraction <= CvssBasedAttackExploitabilityBase.userInteractionMetric.range[1];
}

export const checkAttackExploitabilityRange = (attackExploitability: number) => {
    return attackExploitability >= CvssBasedAttackExploitabilityBase.range[0] && attackExploitability <= CvssBasedAttackExploitabilityBase.range[1];
}
